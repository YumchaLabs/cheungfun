# Markdownæ–‡ä»¶å¤¹RAGé—®ç­”ç¤ºä¾‹

è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨Cheungfunæ¡†æ¶æ„å»ºä¸€ä¸ªå®Œæ•´çš„RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ç³»ç»Ÿï¼Œèƒ½å¤Ÿï¼š

1. ğŸ—‚ï¸ æ‰¹é‡åŠ è½½æŒ‡å®šæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰markdownæ–‡ä»¶
2. ğŸ¤– ä½¿ç”¨çœŸå®LLM APIè¿›è¡ŒåµŒå…¥å’Œé—®ç­”
3. ğŸ’¾ æ”¯æŒå†…å­˜æˆ–SQLiteå­˜å‚¨
4. ğŸ” æä¾›è¯­ä¹‰æœç´¢å’Œæ™ºèƒ½é—®ç­”
5. ğŸ¯ æä¾›äº¤äº’å¼æŸ¥è¯¢ç•Œé¢

## åŠŸèƒ½ç‰¹æ€§

- âœ… **å®Œæ•´çš„RAGæµç¨‹**ï¼šæ–‡æ¡£åŠ è½½ â†’ æ–‡æœ¬åˆ†å‰² â†’ å‘é‡åµŒå…¥ â†’ å­˜å‚¨ â†’ æ£€ç´¢ â†’ ç”Ÿæˆå›ç­”
- âœ… **çœŸå®LLMé›†æˆ**ï¼šæ”¯æŒOpenAI GPTå’Œæœ¬åœ°Ollamaæ¨¡å‹
- âœ… **é«˜æ€§èƒ½åµŒå…¥**ï¼šä½¿ç”¨FastEmbedè¿›è¡Œå¿«é€Ÿæ–‡æœ¬åµŒå…¥
- âœ… **çµæ´»å­˜å‚¨**ï¼šæ”¯æŒå†…å­˜å­˜å‚¨å’ŒSQLiteæŒä¹…åŒ–å­˜å‚¨
- âœ… **æ™ºèƒ½æ£€ç´¢**ï¼šåŸºäºè¯­ä¹‰ç›¸ä¼¼åº¦çš„æ–‡æ¡£ç‰‡æ®µæ£€ç´¢
- âœ… **äº¤äº’å¼ç•Œé¢**ï¼šå‘½ä»¤è¡Œäº¤äº’å¼é—®ç­”ä½“éªŒ
- âœ… **è¯¦ç»†ç»Ÿè®¡**ï¼šæä¾›å¤„ç†ç»Ÿè®¡å’Œç³»ç»ŸçŠ¶æ€ä¿¡æ¯

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿ä½ å·²ç»å®‰è£…äº†Rustå’ŒCargoï¼š

```bash
# æ£€æŸ¥Rustç‰ˆæœ¬
rustc --version
cargo --version
```

### 2. è®¾ç½®APIå¯†é’¥ï¼ˆå¯é€‰ï¼‰

å¦‚æœè¦ä½¿ç”¨OpenAI APIï¼š

```bash
# Linux/macOS
export OPENAI_API_KEY="your-api-key-here"

# Windows
set OPENAI_API_KEY=your-api-key-here
```

å¦‚æœæ²¡æœ‰è®¾ç½®APIå¯†é’¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨æœ¬åœ°Ollamaã€‚

### 3. å®‰è£…Ollamaï¼ˆå¦‚æœä¸ä½¿ç”¨OpenAIï¼‰

```bash
# å®‰è£…Ollama
curl -fsSL https://ollama.ai/install.sh | sh

# å¯åŠ¨OllamaæœåŠ¡
ollama serve

# ä¸‹è½½æ¨¡å‹ï¼ˆåœ¨å¦ä¸€ä¸ªç»ˆç«¯ï¼‰
ollama pull llama3.2
```

### 4. è¿è¡Œç¤ºä¾‹

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd cheungfun

# è¿è¡Œç¤ºä¾‹ï¼ˆä½¿ç”¨FastEmbedåµŒå…¥ï¼‰
cargo run --example markdown_rag_example --features "fastembed"

# æˆ–è€…ä½¿ç”¨SQLiteå­˜å‚¨ï¼ˆæš‚æœªå®ç°ï¼‰
cargo run --example markdown_rag_example --features "fastembed,sqlite"
```

## ä½¿ç”¨æ–¹æ³•

### 1. å‡†å¤‡æ–‡æ¡£

å°†ä½ çš„markdownæ–‡ä»¶æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œä¾‹å¦‚ï¼š

```
docs/
â”œâ”€â”€ rust_basics.md
â”œâ”€â”€ rag_introduction.md
â”œâ”€â”€ ai_development.md
â””â”€â”€ your_custom_docs.md
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
# è®¾ç½®æ–‡æ¡£æ–‡ä»¶å¤¹è·¯å¾„
export DOCS_FOLDER="./your-docs-folder"

# è®¾ç½®æ–‡æœ¬åˆ†å—å¤§å°
export CHUNK_SIZE=500

# è®¾ç½®æ£€ç´¢è¿”å›çš„æ–‡æ¡£æ•°é‡
export TOP_K=5
```

### 3. å¯åŠ¨ç³»ç»Ÿ

è¿è¡Œç¤ºä¾‹åï¼Œç³»ç»Ÿä¼šï¼š

1. **åˆå§‹åŒ–ç»„ä»¶**ï¼šåµŒå…¥å™¨ã€å‘é‡å­˜å‚¨ã€LLMå®¢æˆ·ç«¯
2. **æ„å»ºç´¢å¼•**ï¼šæ‰«ææ–‡æ¡£ã€åˆ†å‰²æ–‡æœ¬ã€ç”ŸæˆåµŒå…¥ã€å­˜å‚¨å‘é‡
3. **å¯åŠ¨é—®ç­”**ï¼šè¿›å…¥äº¤äº’å¼é—®ç­”æ¨¡å¼

### 4. äº¤äº’å¼é—®ç­”

```
ğŸ¤” æ‚¨çš„é—®é¢˜: ä»€ä¹ˆæ˜¯Rustï¼Ÿ

ğŸ” æ­£åœ¨æœç´¢ç›¸å…³å†…å®¹...

ğŸ¤– AIå›ç­”:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Rustæ˜¯ä¸€ç§ç³»ç»Ÿç¼–ç¨‹è¯­è¨€ï¼Œä¸“æ³¨äºå®‰å…¨æ€§ã€é€Ÿåº¦å’Œå¹¶å‘æ€§ã€‚å®ƒç”±Mozillaå¼€å‘ï¼Œæ—¨åœ¨è§£å†³Cå’ŒC++ä¸­å¸¸è§çš„å†…å­˜å®‰å…¨é—®é¢˜ï¼ŒåŒæ—¶ä¿æŒé«˜æ€§èƒ½ã€‚Rusté€šè¿‡æ‰€æœ‰æƒç³»ç»Ÿåœ¨ç¼–è¯‘æ—¶é˜²æ­¢å†…å­˜æ³„æ¼ã€æ‚¬ç©ºæŒ‡é’ˆå’Œæ•°æ®ç«äº‰ç­‰é—®é¢˜ã€‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ“š å‚è€ƒæ¥æº (3 ä¸ªç›¸å…³ç‰‡æ®µ):
  1. [ç›¸ä¼¼åº¦: 0.892] rust_basics.md
     é¢„è§ˆ: # Rustç¼–ç¨‹è¯­è¨€åŸºç¡€\n\n## ä»€ä¹ˆæ˜¯Rustï¼Ÿ\n\nRustæ˜¯ä¸€ç§ç³»ç»Ÿç¼–ç¨‹è¯­è¨€ï¼Œä¸“æ³¨äºå®‰å…¨æ€§ã€é€Ÿåº¦å’Œå¹¶å‘æ€§...
  2. [ç›¸ä¼¼åº¦: 0.756] rust_basics.md  
     é¢„è§ˆ: ## Rustçš„æ ¸å¿ƒç‰¹æ€§\n\n### 1. å†…å­˜å®‰å…¨\nRusté€šè¿‡æ‰€æœ‰æƒç³»ç»Ÿï¼ˆOwnership Systemï¼‰...
  3. [ç›¸ä¼¼åº¦: 0.689] rust_basics.md
     é¢„è§ˆ: ### 3. å¹¶å‘å®‰å…¨\nRustçš„ç±»å‹ç³»ç»Ÿé˜²æ­¢æ•°æ®ç«äº‰ï¼Œä½¿å¹¶å‘ç¼–ç¨‹æ›´åŠ å®‰å…¨...

âš¡ æ€§èƒ½ä¿¡æ¯:
  - æŸ¥è¯¢æ—¶é—´: 1.234s
  - Tokenä½¿ç”¨: 156 prompt + 89 completion = 245 total
```

### 5. å¯ç”¨å‘½ä»¤

åœ¨é—®ç­”æ¨¡å¼ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

- `help` - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
- `stats` - æ˜¾ç¤ºç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯
- `quit` æˆ– `exit` - é€€å‡ºç¨‹åº

## é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡é…ç½®

| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `DOCS_FOLDER` | `./docs` | markdownæ–‡æ¡£æ–‡ä»¶å¤¹è·¯å¾„ |
| `CHUNK_SIZE` | `500` | æ–‡æœ¬åˆ†å—å¤§å° |
| `CHUNK_OVERLAP` | `50` | åˆ†å—é‡å å¤§å° |
| `TOP_K` | `5` | æ£€ç´¢è¿”å›çš„æ–‡æ¡£æ•°é‡ |
| `OPENAI_API_KEY` | - | OpenAI APIå¯†é’¥ |

### ä»£ç é…ç½®

ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹ä»£ç ä¸­çš„`RagConfig`ç»“æ„ä½“ï¼š

```rust
impl Default for RagConfig {
    fn default() -> Self {
        Self {
            docs_folder: PathBuf::from("./docs"),
            use_sqlite: false,
            chunk_size: 500,
            chunk_overlap: 50,
            top_k: 5,
            llm_provider: "openai".to_string(),
            llm_model: "gpt-3.5-turbo".to_string(),
        }
    }
}
```

## ç¤ºä¾‹æŸ¥è¯¢

ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹æŸ¥è¯¢ï¼Œä½ å¯ä»¥å°è¯•ï¼š

### å…³äºRustçš„é—®é¢˜
- "Rustæœ‰å“ªäº›æ ¸å¿ƒç‰¹æ€§ï¼Ÿ"
- "Rusté€‚ç”¨äºå“ªäº›åº”ç”¨é¢†åŸŸï¼Ÿ"
- "Rustå¦‚ä½•ä¿è¯å†…å­˜å®‰å…¨ï¼Ÿ"

### å…³äºRAGçš„é—®é¢˜
- "ä»€ä¹ˆæ˜¯RAGç³»ç»Ÿï¼Ÿ"
- "RAGç³»ç»Ÿæœ‰å“ªäº›ç»„ä»¶ï¼Ÿ"
- "RAGçš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"

### å…³äºAIå¼€å‘çš„é—®é¢˜
- "AIå¼€å‘çš„ç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬å“ªäº›é˜¶æ®µï¼Ÿ"
- "æœ‰å“ªäº›å¸¸ç”¨çš„AIå¼€å‘å·¥å…·ï¼Ÿ"
- "AIå¼€å‘çš„æœ€ä½³å®è·µæ˜¯ä»€ä¹ˆï¼Ÿ"

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **FastEmbedåˆå§‹åŒ–å¤±è´¥**
   ```
   è§£å†³æ–¹æ¡ˆï¼šç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸ï¼ŒFastEmbedéœ€è¦ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹
   ```

2. **Ollamaè¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥Ollamaæ˜¯å¦è¿è¡Œ
   curl http://localhost:11434/api/tags
   
   # é‡å¯OllamaæœåŠ¡
   ollama serve
   ```

3. **OpenAI APIè°ƒç”¨å¤±è´¥**
   ```
   è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥APIå¯†é’¥æ˜¯å¦æ­£ç¡®è®¾ç½®ï¼Œè´¦æˆ·æ˜¯å¦æœ‰è¶³å¤Ÿä½™é¢
   ```

4. **æ–‡æ¡£åŠ è½½å¤±è´¥**
   ```
   è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥æ–‡æ¡£æ–‡ä»¶å¤¹è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿æœ‰.mdæ–‡ä»¶
   ```

### è°ƒè¯•æ¨¡å¼

å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š

```bash
RUST_LOG=debug cargo run --example markdown_rag_example --features "fastembed"
```

## æ‰©å±•åŠŸèƒ½

### æ·»åŠ æ–°çš„æ–‡æ¡£ç±»å‹

ä¿®æ”¹`DirectoryLoader`é…ç½®ä»¥æ”¯æŒæ›´å¤šæ–‡ä»¶ç±»å‹ï¼š

```rust
let loader_config = LoaderConfig::new()
    .with_include_extensions(vec![
        "md".to_string(),
        "txt".to_string(),
        "rst".to_string(),
    ])
    .with_max_depth(Some(10))
    .with_continue_on_error(true);
```

### è‡ªå®šä¹‰åµŒå…¥æ¨¡å‹

æ›¿æ¢FastEmbedä¸ºå…¶ä»–åµŒå…¥å™¨ï¼š

```rust
// ä½¿ç”¨OpenAIåµŒå…¥
let embedder = Arc::new(ApiEmbedder::openai("your-api-key").await?);

// ä½¿ç”¨Candleæœ¬åœ°åµŒå…¥
let embedder = Arc::new(CandleEmbedder::from_pretrained("model-name").await?);
```

### æ·»åŠ SQLiteå­˜å‚¨

å®ç°SQLiteå‘é‡å­˜å‚¨ï¼ˆå½“å‰ä¸ºTODOï¼‰ï¼š

```rust
// TODO: å®ç°SQLiteå‘é‡å­˜å‚¨
let vector_store = Arc::new(SqliteVectorStore::new("rag.db").await?);
```

## æ€§èƒ½ä¼˜åŒ–

1. **è°ƒæ•´åˆ†å—å¤§å°**ï¼šæ ¹æ®æ–‡æ¡£ç±»å‹è°ƒæ•´`chunk_size`å’Œ`chunk_overlap`
2. **ä¼˜åŒ–æ£€ç´¢æ•°é‡**ï¼šè°ƒæ•´`top_k`å€¼å¹³è¡¡å‡†ç¡®æ€§å’Œæ€§èƒ½
3. **ä½¿ç”¨GPUåŠ é€Ÿ**ï¼šå¦‚æœæœ‰GPUï¼Œå¯ä»¥ä½¿ç”¨Candle GPUåµŒå…¥å™¨
4. **ç¼“å­˜åµŒå…¥**ï¼šå¯¹äºå¤§é‡æ–‡æ¡£ï¼Œè€ƒè™‘ç¼“å­˜åµŒå…¥ç»“æœ

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªç¤ºä¾‹ï¼

## è®¸å¯è¯

æœ¬ç¤ºä¾‹éµå¾ªCheungfuné¡¹ç›®çš„è®¸å¯è¯ã€‚
